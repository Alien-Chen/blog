(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{485:function(s,e,a){s.exports=a.p+"assets/img/pack01.f5de8ab1.png"},486:function(s,e,a){s.exports=a.p+"assets/img/pack02.d30dd0cf.png"},534:function(s,e,a){"use strict";a.r(e);var t=a(2),n=Object(t.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("我们从输入 URL 到显示页面这个过程中，涉及到网络层面的，有三个主要过程：")]),s._v(" "),e("ul",[e("li",[s._v("DNS 解析")]),s._v(" "),e("li",[s._v("TCP 连接")]),s._v(" "),e("li",[s._v("HTTP 请求/响应")])]),s._v(" "),e("p",[s._v("对于DNS解析和TCP连接这两个步骤，我们前端可以做的努力非常的有限。相比之下，HTTP 连接这一层面的优化才是我们网络优化的核心。")]),s._v(" "),e("p",[s._v("HTTP优化有两个大方向：")]),s._v(" "),e("ul",[e("li",[s._v("减少请求次数")]),s._v(" "),e("li",[s._v("减少单次请求所花费的时间")])]),s._v(" "),e("p",[s._v("这两个优化点直直地指向了我们日常开发中非常常见的操作——资源的压缩与合并。那么我在开发的时候使用的是webpack，我们就从webpack下手：")]),s._v(" "),e("h2",{attrs:{id:"开始优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开始优化"}},[s._v("#")]),s._v(" 开始优化")]),s._v(" "),e("p",[s._v("首先开始优化前需要使用到 webpack-bundle-analyzer 这个非常非常好用的包组成可视化工具。它会以矩形树图的形式将包内各个模块的大小和依赖关系呈现出来。")]),s._v(" "),e("p",[s._v("首先我们在进行打包优化时候我们先做好一下几点的优化：")]),s._v(" "),e("ul",[e("li",[s._v("路由懒加载")]),s._v(" "),e("li",[s._v("异步组件")])]),s._v(" "),e("h3",{attrs:{id:"第一步"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第一步"}},[s._v("#")]),s._v(" 第一步")]),s._v(" "),e("p",[s._v("通过 bundle-analyzer的分析 我们可以看到 app.js的style.scss的体积达到了900kb，这是有点大的，所以去源码里面定位发现 多次的引入"),e("code",[s._v("import '../src/styles/element-variables.scss")]),s._v(" 进行删除后节约了 500kb")]),s._v(" "),e("h3",{attrs:{id:"第二步-externals-提取项目依赖"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第二步-externals-提取项目依赖"}},[s._v("#")]),s._v(" 第二步，externals 提取项目依赖")]),s._v(" "),e("p",[s._v("从打包分析中可以看到chunk-vendors.js中 vue,vue-router,vuex,element-ui,axios,echarts,v-charts 占据了一定体积，而这些依赖都是比较稳定的不常修改的公共依赖包。所以我们可以把这些依赖包提取出来。这里把ElementUI也提取出来没用按需加载是因为项目中使用到的elment范围很广按需加载优化力度不大，所以直接提取出来。")]),s._v(" "),e("p",[s._v("注意：项目中引用到这些依赖的全都换成require引入！！")]),s._v(" "),e("p",[s._v("webpack 添加一下配置")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("externals: {\n  'vue': 'Vue',\n  'vue-router': 'VueRouter',\n  'vuex': 'Vuex',\n  'element-ui': 'ELEMENT',\n  'axios': 'axios',\n  'echarts': 'echarts',\n  'v-charts': 'VeChart'\n},\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("在index.html 中引入CDN：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('  <script src="https://lib.baomitu.com/vue/2.7.6/vue.min.js"><\/script>\n    <script src="https://lib.baomitu.com/vue-router/3.5.1/vue-router.min.js"><\/script>\n    <script src="https://lib.baomitu.com/axios/1.2.1/axios.min.js"><\/script>\n    <script src="https://lib.baomitu.com/vuex/3.6.2/vuex.min.js"><\/script>\n    <script src="https://lib.baomitu.com/element-ui/2.15.13/index.js"><\/script>\n    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"><\/script>\n  <script src="https://cdn.jsdelivr.net/npm/v-charts/lib/index.min.js"><\/script>\n  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/v-charts/lib/style.min.css">\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h3",{attrs:{id:"第三步-减小三方依赖的体积"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第三步-减小三方依赖的体积"}},[s._v("#")]),s._v(" 第三步，减小三方依赖的体积")]),s._v(" "),e("ol",[e("li",[s._v("项目中用到moment.js 但是里面有一大部分的语言包没有用到，所以我们需要剔除掉这些语言包的打包，方法如下：")])]),s._v(" "),e("p",[s._v("使用 moment-locales-webpack-plugin 插件，剔除掉无用的语言包")]),s._v(" "),e("p",[s._v("安装：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("npm install moment-locales-webpack-plugin -D\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("使用：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const MomentLocalesPlugin = require('moment-locales-webpack-plugin');\n\nmodule.exports = {\n  configureWebpack: {\n     plugins: [\n       new MomentLocalesPlugin({localesToKeep: ['zh-cn']})\n     ]\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("项目中还用到了 lodash，但是项目中前端小伙伴们全部通过"),e("code",[s._v("import _ from 'lodash'")]),s._v("的方式引入，这样一来lodash的方法会被全部打包的。所以我逐个进行了具体引入如下：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import cloneDeep from 'lodash/cloneDeep'\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("通过以上的操作又节约了 400KB")]),s._v(" "),e("p",[s._v("重新打包，最新数据如下：")]),s._v(" "),e("p",[s._v("打包后的体积：\n"),e("img",{attrs:{src:a(485),alt:"npm img"}})]),s._v(" "),e("p",[s._v("可以看到打包体积由原来的25MB 变为了 19MB, 效果还是非常可观的")]),s._v(" "),e("h3",{attrs:{id:"第四步-压缩js"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第四步-压缩js"}},[s._v("#")]),s._v(" 第四步 压缩js")]),s._v(" "),e("p",[s._v("从分析报告中可以看出来，项目中的源码也占据了很多体积很多个chunk都是几百KB，这边我看出来了webpack没有配置js压缩，这可是个大头：")]),s._v(" "),e("p",[s._v("所以我加上了 "),e("code",[s._v("terser-webpack-plugin")]),s._v(" 进行压缩js")]),s._v(" "),e("p",[s._v("在配置项中引入：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("optimization: {\n minimizer: [\n  new TerserPlugin({\n     test: /\\.js(\\?.*)?$/i,\n     parallel: true\n   }),\n ]\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("接下来重新打包：")]),s._v(" "),e("p",[e("img",{attrs:{src:a(486),alt:"npm img"}})]),s._v(" "),e("p",[s._v("打包体积直接从 19MB 到 7.5MB 了，可谓是质的飞跃。")])])}),[],!1,null,null,null);e.default=n.exports}}]);