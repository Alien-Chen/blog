(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{568:function(s,t,n){s.exports=n.p+"assets/img/circle01.2c74ff69.jpg"},569:function(s,t,n){s.exports=n.p+"assets/img/circle02.4ba0e365.jpg"},570:function(s,t,n){s.exports=n.p+"assets/img/circle03.4d9738a4.jpg"},571:function(s,t,n){s.exports=n.p+"assets/img/circle04.eefd5542.jpg"},572:function(s,t,n){s.exports=n.p+"assets/img/circle05.167ab025.jpg"},595:function(s,t,n){"use strict";n.r(t);var a=n(13),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"circle-ci-的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#circle-ci-的使用"}},[s._v("#")]),s._v(" Circle CI 的使用")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("注册，"),a("a",{attrs:{href:"https://app.circleci.com",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网地址"),a("OutboundLink")],1),s._v(",进入到页面后点击Sign Up 按钮，选择Sign up with Github 进行github的授权登录，根据指引完成登录，登录后我们就可以看到我们github账号中的所有仓库了。")])]),s._v(" "),a("li",[a("p",[s._v("接下来就是，我们需要在github中创建一个新的仓库 或者 你已经有了现成的仓库可以忽略掉这一步。")])]),s._v(" "),a("li",[a("p",[s._v("将我们需要配置自动化的仓库同步到本地后，我们需要在项目根目录下创建一个.circle文件夹，文件夹下需要创建一个config.yml,以下提供了我的配置供大家参考（配置中的fingerprints，后面会讲如何获取到这个key）：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\njobs:\n build:\n     docker:\n     - image: circleci/node:10\n     steps:\n     - run: "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"A first hello"')]),s._v("\n     - run: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" -v\n\n")])])])]),s._v(" "),a("li",[a("p",[s._v("将我们所添加的.circle 相关的代码提交到远程仓库去")])]),s._v(" "),a("li",[a("p",[s._v("现在我们进入到Circle的管理后台我们就可以看到多出了一个我们刚刚提交的项目如下（以我的blog项目为例子）：\n"),a("img",{attrs:{src:n(568),alt:"circle png"}})])]),s._v(" "),a("li",[a("p",[s._v("点击 set Up Project，会询问你是否有配置config.yml文件，如果没有可以选择它提供的默认配置，这里因为我们已经在先前配置了config.yml文件了，所以我们选择用自己的配置，如下：\n"),a("img",{attrs:{src:n(569),alt:"circle png"}})])]),s._v(" "),a("li",[a("p",[s._v("经过上一步circle会帮我们自动build一次，如下：\n"),a("img",{attrs:{src:n(570),alt:"circle png"}})])]),s._v(" "),a("li",[a("p",[s._v("因为涉及到circle需要去远程仓库拉取代码，所以我们需要设置ssh密钥，点击项目面板右侧的"),a("code",[s._v("Project Settings")]),s._v("里面点击SSH Keys侧边栏选项，进入SSH keys配置页后，点击userkey栏目下的"),a("code",[s._v("Authorize with Github")]),s._v("，再回来点击 "),a("code",[s._v("Add User Key")]),s._v("，就会形成Deploy Key，如下：\n"),a("img",{attrs:{src:n(571),alt:"circle png"}}),s._v("\n创建 Deploy Key的作用是可以让Circle直接访问Github仓库，防止没有权限读写的情况")])]),s._v(" "),a("li",[a("p",[s._v("添加完成需要开始编写config.yml:")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\njobs:\n  build:\n    docker:\n    - image: circleci/node:10\n    branches:\n    only:\n        - master\n    steps:\n    - add_ssh_keys:\n        fingerprints:\n            - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个自己生成")]),s._v("\n    - checkout\n    - restore_cache: "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 node_modules的缓存")]),s._v("\n        keys:\n            - dependencies_blog\n    - run: "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"A first hello"')]),s._v("\n    - run: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" -v\n    - run:\n        name: Install\n        command: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n    - save_cache: "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这一步是为了对node_module进行缓存，避免每次构建都重新下载依赖")]),s._v("\n        paths:\n            - node_modules\n        key: dependencies_blog\n    - run:\n        name: Build\n        command: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" docs:build\n    - run:\n        name: grant authority\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 赋予执行权限 shell chmod +x")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行shell脚本")]),s._v("\n        command: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x scripts/deploy.sh\n    - run: "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行 将dist目录提交到 gh_pages 分支的脚本")]),s._v("\n        name: deloy github\n        command: ./scripts/deploy.sh\n")])])])]),s._v(" "),a("li",[a("p",[s._v("在项目根目录下创建一个scripts文件夹，文件夹下创建一个deploy.sh 我们来编写脚本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $XXX 为全局变量 等下需要配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 告诉linux这个是个shell脚本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/sh")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果没有结束到一个非0的数值的话就推出shell脚本的执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -e\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打印当前的工作路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("remote")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" config remote.origin.url"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'remote is: '")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新建一个发布目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" gh-pages-branch\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" gh-pages-branch\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个新的仓库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置发布的用户与邮箱")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" config --global user.email "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GH_EMAIL")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" config --global user.name "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GH_NAME")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" init\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" remote "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" --fetch origin "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote")]),s._v('"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'email is: '")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GH_EMAIL")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name is: '")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GH_NAME")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sitesource is: '")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$siteSource")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 切换gh-pages分支")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" rev-parse --verify origin/gh-pages "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" checkout gh-pages\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除掉旧的文件内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" checkout --orphan gh-pages\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把构建好的文件目录给拷贝进来")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${siteSource}")]),s._v('/."')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -la\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把所有的文件添加到git中")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" -A\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加一条提交内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" commit --allow-empty -m "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Deploy to Github page [ci skip]"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 推送文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" push --force --quiet origin gh-pages\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 资源回收，删除临时分支与目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf gh-pages-branch\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Finished"')]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("配置环境变量\n"),a("img",{attrs:{src:n(572),alt:"circle png"}})])]),s._v(" "),a("li",[a("p",[s._v("接下来就可以愉快的提交代码，见证奇迹的时刻到了！")])]),s._v(" "),a("li")])])}),[],!1,null,null,null);t.default=e.exports}}]);