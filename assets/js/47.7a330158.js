(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{536:function(s,n,a){"use strict";a.r(n);var e=a(2),l=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("在项目业务上表单的需求多变，不同需求也会有不同的表单组合。这部分的开发投入是可以减小的。简单的分析一下，变动的主要是表单控件和逻辑判断。所以首先想到的就是开发一个配置式的表单，设计一个新的表单schema规范。然后根据schema规范编写表单的JSON对象，最后由表单JSON动态生成表单。下面就是一段常用的基于schema的表单JSON代码：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('{\n  "type": "input",\n  "propName": "username", // 用于设置传递给后端的字段名称\n  "icon": "text-field",\n  "formItemFlag": true,\n  "options": {\n    //-------------------\n    以下是组件属性\n    "name": "input115643",\n    "label": "input",\n    "labelAlign": "",\n    "type": "text",\n    "defaultValue": "",\n    "placeholder": "",\n    "columnWidth": "200px",\n    "size": "",\n    "labelWidth": null,\n    "labelHidden": false,\n    "readonly": false,\n    "disabled": false,\n    "hidden": false,\n    "clearable": true,\n    "showPassword": false,\n    "required": false,\n    "requiredHint": "",\n    "validation": "",\n    "validationHint": "",\n    "customClass": [],\n    "labelIconClass": null,\n    "labelIconPosition": "rear",\n    "labelTooltip": null,\n    "minLength": null,\n    "maxLength": null,\n    "showWordLimit": false,\n    "prefixIcon": "",\n    "suffixIcon": "",\n    "appendButton": false,\n    "appendButtonDisabled": false,\n    "buttonIcon": "el-icon-search"\n  },\n  "id": "input115643"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br")])]),n("p",[s._v("但是如果通过传入到表单JSON去渲染组件中这种方案有两个比较明显的缺点：")]),s._v(" "),n("ol",[n("li",[s._v("使用者需要学习schema规范")]),s._v(" "),n("li",[s._v("难于实现复杂的表单交互逻辑")])]),s._v(" "),n("p",[s._v("为了解决第一个schema规范学习成本的问题。可以基于表单schema开发一个拖拽式的表单设计器，这样就可以所见即所得，现在也有很多开源项目实现，form generator、form creator等等的开源项目。但是由于本业务使用的ui框架是Hui(恒生的一套ui框架)，由于ui参数与展示不同所以需要自己搞一套表单设计器。")]),s._v(" "),n("p",[s._v("为了解决第二个问题，如何实现动态表单的复杂交互逻辑，思路为 为动态表单添加可编程接口，即通过组件的交互事件和API方法实现逻辑交互。")]),s._v(" "),n("h3",{attrs:{id:"实现可编程接口"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现可编程接口"}},[s._v("#")]),s._v(" 实现可编程接口")]),s._v(" "),n("p",[s._v("要实现表单交互逻辑，第一步需要暴露组件交互事件，比如“活动类型”组件点击后出发onChange事件；第二步就是在事件中对组件进行精确控制，比如显示和隐藏某些组件、设置组件必填属性、设置禁用组件等等。")]),s._v(" "),n("p",[s._v("第一步比较简单，只要给schema增加组件的7个自定义事件即可，如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('{\n  "type": "input",\n  "propName": "username", // 用于设置传递给后端的字段名称\n  "icon": "text-field",\n  "formItemFlag": true,\n  "options": {\n    //-------------------\n    以下是组件属性\n    "name": "input115643",\n    "label": "input",\n    "labelAlign": "",\n    "type": "text",\n    "defaultValue": "",\n    "placeholder": "",\n    "columnWidth": "200px",\n    "size": "",\n    "labelWidth": null,\n    "labelHidden": false,\n    "readonly": false,\n    "disabled": false,\n    "hidden": false,\n    "clearable": true,\n    "showPassword": false,\n    "required": false,\n    "requiredHint": "",\n    "validation": "",\n    "validationHint": "",\n    "customClass": [],\n    "labelIconClass": null,\n    "labelIconPosition": "rear",\n    "labelTooltip": null,\n    "minLength": null,\n    "maxLength": null,\n    "showWordLimit": false,\n    "prefixIcon": "",\n    "suffixIcon": "",\n    "appendButton": false,\n    "appendButtonDisabled": false,\n    "buttonIcon": "el-icon-search",\n    //-------------------\n    自定义事件，用于在以下几个出发时机写入自定义的事件\n    "onCreated": "",\n    "onMounted": "",\n    "onInput": "",\n    "onChange": "",\n    "onFocus": "",\n    "onBlur": "",\n    "onValidate": ""\n  },\n  "id": "input115643"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br")])]),n("p",[s._v("代码的编辑选用的是ace-builds这个编辑组件。")]),s._v(" "),n("p",[s._v("第二步就是实现组件的操控API方法，这里又分为两步走：")]),s._v(" "),n("ol",[n("li",[s._v("收集表单组件的实例")]),s._v(" "),n("li",[s._v("调用组件的methods属性中的方法")])]),s._v(" "),n("p",[s._v("先给 renderForm 组件增加一个refList的provider属性，在表单组件中inject注入，当每个组件创建时将本组件实例注入到如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("inject: ['refList'],\ncreated() {\n  this.registerToRefList()\n},\nmethods: {\n registerToRefList() {\n   this.refList[this.field.options.name] = this\n }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("如此一来，我们可以通过options.name去获取表单组件实例，从而调用组件的methods属性中的组件方法，组件方法可以任意填充。")]),s._v(" "),n("p",[s._v("实现一个简单的交互事件：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("var fieldA = this.getWidgetRef('fieldA')\nvar fieldB = this.getWidgetRef('fieldB')\n\nif (value === 1) {\n  fieldA.setHidden(false)\n  fieldB.setHidden(true)\n} else {\n  fieldA.setHidden(true)\n  fieldB.setHidden(false)\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// fieldMixin.js 这个混入会混入表单组件的公共逻辑\ngetWidgetRef(widgetName, showError) {\n  let foundRef = this.refList[widgetName]\n  if (!foundRef && !!showError) {\n    // 错误处理\n  }\n  return foundRef\n},\nsetHidden(flag) {\n  this.field.options.hidden = flag\n\n  if (flag) {  //清除组件校验规则\n    this.clearFieldRules()\n  } else {  //重建组件校验规则\n    this.buildFieldRules()\n  }\n},\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("自定义事件的执行过程是 通过 Function生成匿名函数，传入指定参数执行。")])])}),[],!1,null,null,null);n.default=l.exports}}]);